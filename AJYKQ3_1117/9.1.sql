CREATE DATABASE AJYKQ3;
USE AJYKQ3;
CREATE TABLE GYARTO(adoszam INT PRIMARY KEY, nev CHAR(30) NOT NULL, iranyitoszam CHAR(4), varos char(40), utac char(100));
CREATE TABLE EGYSEGEK(aru INT REFERENCES TERMEK, db INT CHECK(db>0));
CREATE TABLE ALKATRESZ(akod INT PRIMARY KEY, nev CHAR(30) NOT NULL);
CREATE TABLE KOMPONENS(termek INT REFERENCES TERMEK, alkatresz INT REFERENCES ALKATRESZ);
CREATE TABLE TERMEK(tkod INT PRIMARY KEY, nev CHAR(30) NOT NULL, ear INT CHECK(ear>0), gyarto INT REFERENCES GYARTO);



INSERT INTO GYARTO VALUES(11111111, "mediamarkt", 4090, NULL, NULL);
INSERT INTO GYARTO VALUES(33333333, "lidl", 6024, NULL, NULL);
INSERT INTO GYARTO VALUES(44444444, "penny", 1046, NULL, NULL);
INSERT INTO GYARTO VALUES(22222222, "obi", 3021, "Hajdúszoboszló", "Petőfi utca");



INSERT INTO TERMEK VALUES(2, "lámpa", 3000, 11111111);
INSERT INTO TERMEK VALUES(3, "monitor", 15000, 11111111);
INSERT INTO TERMEK VALUES(0, "billentyűzet", 5000, 11111111);
INSERT INTO TERMEK VALUES(1, "ásó", 2000, 22222222);
INSERT INTO TERMEK VALUES(4, "szőnyeg", 10000, 22222222);



INSERT INTO EGYSEGEK VALUES(0, 10);
INSERT INTO EGYSEGEK VALUES(1, 18);
INSERT INTO EGYSEGEK VALUES(4, 40);
INSERT INTO EGYSEGEK VALUES(2, 34);
INSERT INTO EGYSEGEK VALUES(3, 100);



INSERT INTO ALKATRESZ VALUES(03, "BILLENTYŰ");
INSERT INTO ALKATRESZ VALUES(04, "FESTÉK");
INSERT INTO ALKATRESZ VALUES(00, "FOGASKERÉK");
INSERT INTO ALKATRESZ VALUES(01, "BOT");
INSERT INTO ALKATRESZ VALUES(02, "VAS");



INSERT INTO KOMPONENS VALUES(0, 00);
INSERT INTO KOMPONENS VALUES(0, 03);
INSERT INTO KOMPONENS VALUES(3, 03);
INSERT INTO KOMPONENS VALUES(1, 02);
INSERT INTO KOMPONENS VALUES(3, 00);
INSERT INTO KOMPONENS VALUES(2, 04);
INSERT INTO KOMPONENS VALUES(1, 01);
INSERT INTO KOMPONENS VALUES(4, 04);



ALTER TABLE ALKATRESZ ADD(ar INT, CHECK(ar>0));
SELECT * FROM ALKATRESZ;
SELECT nev FROM gyarto WHERE adoszam NOT IN (SELECT gyarto FROM termek);
UPDATE termek SET ear = 1.1*ear WHERE tkod IN (SELECT termek FROM komponens WHERE alkatresz = (SELECT akod FROM alkatresz WHERE nev = "X"));
CREATE VIEW et AS SELECT MAX(t.nev) nev, t.tkod, COUNT(*) db FROM termek t INNER JOIN egysegek e ON e.aru = t.tkod GROUP BY t.tkod;
SELECT nev FROM et WHERE db = (SELECT MAX(db) FROM et);
